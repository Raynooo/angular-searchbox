"use strict";angular.module("mgcrea.ngStrap.tooltip",["mgcrea.ngStrap.helpers.dimensions"]).provider("$tooltip",function(){var e=this.defaults={animation:"am-fade",prefixClass:"tooltip",prefixEvent:"tooltip",container:!1,placement:"top",template:"tooltip/tooltip.tpl.html",contentTemplate:!1,trigger:"hover focus",keyboard:!1,html:!1,show:!1,title:"",type:"",delay:0};this.$get=["$window","$rootScope","$compile","$q","$templateCache","$http","$animate","$timeout","dimensions","$$rAF",function(t,n,i,a,o,s,r,l,c,u){function d(t,a){function o(){return"body"===$.container?c.offset(t[0]):c.position(t[0])}function s(e,t,n,i){var a,o=e.split("-");switch(o[0]){case"right":a={top:t.top+t.height/2-i/2,left:t.left+t.width};break;case"bottom":a={top:t.top+t.height,left:t.left+t.width/2-n/2};break;case"left":a={top:t.top+t.height/2-i/2,left:t.left-n};break;default:a={top:t.top-i,left:t.left+t.width/2-n/2}}if(!o[1])return a;if("top"===o[0]||"bottom"===o[0])switch(o[1]){case"left":a.left=t.left;break;case"right":a.left=t.left+t.width-n}else if("left"===o[0]||"right"===o[0])switch(o[1]){case"top":a.top=t.top-i;break;case"bottom":a.top=t.top+t.height}return a}var l={},d=t[0].nodeName.toLowerCase(),$=l.$options=angular.extend({},e,a);l.$promise=p($.template);var v=l.$scope=$.scope&&$.scope.$new()||n.$new();$.delay&&angular.isString($.delay)&&($.delay=parseFloat($.delay)),$.title&&(l.$scope.title=$.title),v.$hide=function(){v.$$postDigest(function(){l.hide()})},v.$show=function(){v.$$postDigest(function(){l.show()})},v.$toggle=function(){v.$$postDigest(function(){l.toggle()})},l.$isShown=v.$isShown=!1;var y,b;$.contentTemplate&&(l.$promise=l.$promise.then(function(e){var t=angular.element(e);return p($.contentTemplate).then(function(e){var n=f('[ng-bind="content"]',t[0]);return n.length||(n=f('[ng-bind="title"]',t[0])),n.removeAttr("ng-bind").html(e),t[0].outerHTML})}));var w,L,x,k;return l.$promise.then(function(e){angular.isObject(e)&&(e=e.data),$.html&&(e=e.replace(g,'ng-bind-html="')),e=h.apply(e),x=e,w=i(e),l.init()}),l.init=function(){$.delay&&angular.isNumber($.delay)&&($.delay={show:$.delay,hide:$.delay}),"self"===$.container?k=t:$.container&&(k=f($.container));var e=$.trigger.split(" ");angular.forEach(e,function(e){"click"===e?t.on("click",l.toggle):"manual"!==e&&(t.on("hover"===e?"mouseenter":"focus",l.enter),t.on("hover"===e?"mouseleave":"blur",l.leave),"button"===d&&"hover"!==e&&t.on(m?"touchstart":"mousedown",l.$onFocusElementMouseDown))}),$.show&&v.$$postDigest(function(){"focus"===$.trigger?t[0].focus():l.show()})},l.destroy=function(){for(var e=$.trigger.split(" "),n=e.length;n--;){var i=e[n];"click"===i?t.off("click",l.toggle):"manual"!==i&&(t.off("hover"===i?"mouseenter":"focus",l.enter),t.off("hover"===i?"mouseleave":"blur",l.leave),"button"===d&&"hover"!==i&&t.off(m?"touchstart":"mousedown",l.$onFocusElementMouseDown))}L&&(L.remove(),L=null),v.$destroy()},l.enter=function(){return clearTimeout(y),b="in",$.delay&&$.delay.show?void(y=setTimeout(function(){"in"===b&&l.show()},$.delay.show)):l.show()},l.show=function(){v.$emit($.prefixEvent+".show.before",l);var e=$.container?k:null,n=$.container?null:t;L&&L.remove(),L=l.$element=w(v,function(){}),L.css({top:"0px",left:"0px",display:"block"}).addClass($.placement),$.animation&&L.addClass($.animation),$.type&&L.addClass($.prefixClass+"-"+$.type),r.enter(L,e,n,function(){v.$emit($.prefixEvent+".show",l)}),l.$isShown=v.$isShown=!0,v.$$phase||v.$root.$$phase||v.$digest(),u(l.$applyPlacement),$.keyboard&&("focus"!==$.trigger?(l.focus(),L.on("keyup",l.$onKeyUp)):t.on("keyup",l.$onFocusKeyUp))},l.leave=function(){return clearTimeout(y),b="out",$.delay&&$.delay.hide?void(y=setTimeout(function(){"out"===b&&l.hide()},$.delay.hide)):l.hide()},l.hide=function(e){return l.$isShown?(v.$emit($.prefixEvent+".hide.before",l),r.leave(L,function(){v.$emit($.prefixEvent+".hide",l)}),l.$isShown=v.$isShown=!1,v.$$phase||v.$root.$$phase||v.$digest(),$.keyboard&&null!==L&&L.off("keyup",l.$onKeyUp),e&&"focus"===$.trigger?t[0].blur():void 0):void 0},l.toggle=function(){l.$isShown?l.leave():l.enter()},l.focus=function(){L[0].focus()},l.$applyPlacement=function(){if(L){var e=o(),t=L.prop("offsetWidth"),n=L.prop("offsetHeight"),i=s($.placement,e,t,n);i.top+="px",i.left+="px",L.css(i)}},l.$onKeyUp=function(e){27===e.which&&l.hide()},l.$onFocusKeyUp=function(e){27===e.which&&t[0].blur()},l.$onFocusElementMouseDown=function(e){e.preventDefault(),e.stopPropagation(),l.$isShown?t[0].blur():t[0].focus()},l}function f(e,t){return angular.element((t||document).querySelectorAll(e))}function p(e){return a.when(o.get(e)||s.get(e)).then(function(t){return angular.isObject(t)?(o.put(e,t.data),t.data):t})}var h=String.prototype.trim,m="createTouch"in t.document,g=/ng-bind="/gi;return d}]}).directive("bsTooltip",["$window","$location","$sce","$tooltip","$$rAF",function(e,t,n,i,a){return{restrict:"EAC",scope:!0,link:function(e,t,o){var s={scope:e};angular.forEach(["template","contentTemplate","placement","container","delay","trigger","keyboard","html","animation","type"],function(e){angular.isDefined(o[e])&&(s[e]=o[e])}),angular.forEach(["title"],function(t){o[t]&&o.$observe(t,function(i,o){e[t]=n.trustAsHtml(i),angular.isDefined(o)&&a(function(){r&&r.$applyPlacement()})})}),o.bsTooltip&&e.$watch(o.bsTooltip,function(t,n){angular.isObject(t)?angular.extend(e,t):e.title=t,angular.isDefined(n)&&a(function(){r&&r.$applyPlacement()})},!0);var r=i(t,s);e.$on("$destroy",function(){r.destroy(),s=null,r=null})}}}]),angular.module("mgcrea.ngStrap.tooltip").run(["$templateCache",function(e){e.put("tooltip/tooltip.tpl.html",'<div class="tooltip in" ng-show="title"><div class="tooltip-arrow"></div><div class="tooltip-inner" ng-bind="title"></div></div>')}]),angular.module("mgcrea.ngStrap.helpers.parseOptions",[]).provider("$parseOptions",function(){var e=this.defaults={regexp:/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/};this.$get=["$parse","$q",function(t,n){function i(i,a){function o(e,t){return e.map(function(e,n){var i,a,o={};return o[u]=e,i=c(t,o),a=p(t,o)||n,{label:i,value:a}})}var s={},r=angular.extend({},e,a);s.$values=[];var l,c,u,d,f,p,h;return s.init=function(){s.$match=l=i.match(r.regexp),c=t(l[2]||l[1]),u=l[4]||l[6],d=l[5],f=t(l[3]||""),p=t(l[2]?l[1]:u),h=t(l[7])},s.valuesFn=function(e,t){return n.when(h(e,t)).then(function(t){return s.$values=t?o(t,e):{},s.$values})},s.init(),s}return i}]}),angular.module("mgcrea.ngStrap.helpers.dimensions",[]).factory("dimensions",["$document","$window",function(){var e=(angular.element,{}),t=e.nodeName=function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()};e.css=function(e,t,n){var i;return i=e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e)[t]:e.style[t],n===!0?parseFloat(i)||0:i},e.offset=function(e){var t=e.getBoundingClientRect(),n=e.ownerDocument;return{width:e.offsetWidth,height:e.offsetHeight,top:t.top+(window.pageYOffset||n.documentElement.scrollTop)-(n.documentElement.clientTop||0),left:t.left+(window.pageXOffset||n.documentElement.scrollLeft)-(n.documentElement.clientLeft||0)}},e.position=function(i){var a,o,s={top:0,left:0};return"fixed"===e.css(i,"position")?o=i.getBoundingClientRect():(a=n(i),o=e.offset(i),o=e.offset(i),t(a,"html")||(s=e.offset(a)),s.top+=e.css(a,"borderTopWidth",!0),s.left+=e.css(a,"borderLeftWidth",!0)),{width:i.offsetWidth,height:i.offsetHeight,top:o.top-s.top-e.css(i,"marginTop",!0),left:o.left-s.left-e.css(i,"marginLeft",!0)}};var n=function(n){var i=n.ownerDocument,a=n.offsetParent||i;if(t(a,"#document"))return i.documentElement;for(;a&&!t(a,"html")&&"static"===e.css(a,"position");)a=a.offsetParent;return a||i.documentElement};return e.height=function(t,n){var i=t.offsetHeight;return n?i+=e.css(t,"marginTop",!0)+e.css(t,"marginBottom",!0):i-=e.css(t,"paddingTop",!0)+e.css(t,"paddingBottom",!0)+e.css(t,"borderTopWidth",!0)+e.css(t,"borderBottomWidth",!0),i},e.width=function(t,n){var i=t.offsetWidth;return n?i+=e.css(t,"marginLeft",!0)+e.css(t,"marginRight",!0):i-=e.css(t,"paddingLeft",!0)+e.css(t,"paddingRight",!0)+e.css(t,"borderLeftWidth",!0)+e.css(t,"borderRightWidth",!0),i},e}]),angular.module("angularjssearchbox",["angularjssearchbox.typeahead"]).directive("sbFocus",["$timeout",function(e){return function(t,n){e(function(){t.useKeywordFacet||n[0].value||n[0].focus()})}}]).directive("repeatDone",function(){return function(e,t){e.bindValueInput(t)}}).directive("searchBox",["$timeout",function(e){return{restrict:"A",templateUrl:"templates/searchBox.html",scope:{resultList:"=",facetList:"=",debug:"=?"},controller:function(t){function n(e){for(var t in e)for(var n in e[t].items)e[t].items[n].hasOwnProperty("label")||(e[t].items[n].label=e[t].items[n].name);return e}function i(e,n){for(var i in t.facetList)if(t.facetList[i].name===e)for(var a in t.facetList[i].items)if(t.facetList[i].items[a].name===n)return t.facetList[i].items[a].label;return n}function a(e){var t=[];for(var n in e){var a=new Object;a.key=e[n].key,a.type="string",a.value=i(a.key,e[n].value),t.push(a)}return t}t.facetList=n(t.facetList),t.sbResultList=a(t.resultList),e(function(){t.selected={key:"",value:""}})},link:function(t,n){t.tmpInputValue=null,t.selectedResult=null,t.debug=t.debug||!1,t.useKeywordFacet=!1,t.hasKeywordFacet=!1;var i=[9,13,37,39];n.find("input").bind("keydown",function(n){-1!==i.indexOf(n.which)&&(n.preventDefault(),13===n.which?(t.useKeywordFacet=!0,e(function(){t.useKeywordFacet&&(t.selected.value="",t.hasKeywordFacet?(t.sbResultList[t.sbResultList.length-1].value+=" "+t.selected.key,t.resultList[t.resultList.length-1].value+=" "+t.selected.key):(t.hasKeywordFacet=!0,t.sbResultList.push({key:"text",type:"string",value:t.selected.key}),t.resultList.push({key:"text",type:"string",value:t.selected.key})),t.selected.key="",e(function(){t.selectInputFacet(),t.selectedResult=null}))})):9===n.which&&t.$apply(function(){}))}),t.bindValueInput=function(n){e(function(){n.find("input").bind("keydown",function(e){-1!==i.indexOf(e.which)&&(e.preventDefault(),(13===e.which||9===e.which)&&(console.log(e),t.hasKeywordFacet&&t.$apply(function(){if("text"!=t.sbResultList[t.sbResultList.length-1].key){var e=t.sbResultList.pop();t.sbResultList.splice(t.sbResultList.length-1,0,e)}}),t.$apply(function(){var n=new Object;n.key=t.sbResultList[e.target.dataset.tahIndex].key,n.type=t.sbResultList[e.target.dataset.tahIndex].type,n.value=t.sbResultList[e.target.dataset.tahIndex].value,t.resultList[e.target.dataset.tahIndex]=n,t.selectInputFacet(),t.selectedResult=null})))})})},t.selectInputFacet=function(){n.find("input")[n.find("input").length-1].focus()},t.getFacetLabel=function(e){for(var n in t.facetList)if(t.facetList[n].name==e)return t.facetList[n].label;return e},t.getValueName=function(e,n,i){for(var a in t.facetList)if(t.facetList[a].name==e)return t.facetList[a].items[n].name;return i},t.getValues=function(e){for(var n in t.facetList)if(t.facetList[n].name==e)return t.facetList[n].items;return[]},t.$on("$typeahead.select",function(n,i,a,o){t.$apply(function(){t.useKeywordFacet=!1,-1==o?(t.selected.value="",t.sbResultList.push({key:i.name,type:i.type,value:""}),t.selected.key=""):e(function(){if(t.hasKeywordFacet&&"text"!=t.sbResultList[t.sbResultList.length-1].key){var e=t.sbResultList.pop();t.sbResultList.splice(t.sbResultList.length-1,0,e),o+=-1}var n=new Object;n.key=t.sbResultList[o].key,n.type=t.sbResultList[o].type,n.value=t.getValueName(n.key,a,i),t.resultList[o]=n,t.selectInputFacet(),t.selectedResult=null},100)})}),t.selectResult=function(e){t.selectedResult=e},t.removeFilter=function(e){"text"===t.sbResultList[e].key&&(t.hasKeywordFacet=!1),t.sbResultList.splice(e,1),t.resultList=t.sbResultList.slice(0)},t.removeAll=function(){t.hasKeywordFacet=!1,t.sbResultList.length=0,t.resultList.length=0}}}}]),angular.module("angularjssearchbox.typeahead",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$typeahead",function(){var e=this.defaults={animation:"am-fade",prefixClass:"typeahead",placement:"bottom-left",template:"templates/typeAhead.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,minLength:1,tahIndex:-1,filter:"filter",limit:6};this.$get=function(t,n,i){function a(t,n,a){var o={},s=angular.extend({},e,a);o=i(t,s);var r=a.scope,l=o.$scope;l.$resetMatches=function(){l.$matches=[],l.$activeIndex=0},l.$resetMatches(),l.$activate=function(e){l.$$postDigest(function(){o.activate(e)})},l.$select=function(e){l.$$postDigest(function(){o.select(e)})},l.$isVisible=function(){return o.$isVisible()},o.update=function(e){l.$matches=e,l.$activeIndex>=e.length&&(l.$activeIndex=0)},o.activate=function(e){l.$activeIndex=e},o.select=function(e){var t=l.$matches[e].value;n.$setViewValue(t),l.$resetMatches(),n.$render(),r&&r.$digest(),l.$emit("$typeahead.select",t,e,s.tahIndex)},o.$isVisible=function(){return s.minLength&&n?l.$matches.length&&angular.isString(n.$viewValue)&&n.$viewValue.length>=s.minLength:!!l.$matches.length},o.$getIndex=function(e){var t=l.$matches.length,n=t;if(t){for(n=t;n--&&l.$matches[n].value!==e;);if(!(0>n))return n}},o.$onMouseDown=function(e){e.preventDefault(),e.stopPropagation()},o.$onKeyDown=function(e){/(38|40|13)/.test(e.keyCode)&&(e.preventDefault(),e.stopPropagation(),13===e.keyCode&&l.$matches.length?o.select(l.$activeIndex):38===e.keyCode&&l.$activeIndex>0?l.$activeIndex--:40===e.keyCode&&l.$activeIndex<l.$matches.length-1?l.$activeIndex++:angular.isUndefined(l.$activeIndex)&&(l.$activeIndex=0),l.$digest())};var c=o.show;o.show=function(){c(),setTimeout(function(){o.$element.on("mousedown",o.$onMouseDown),s.keyboard&&t.on("keydown",o.$onKeyDown)})};var u=o.hide;return o.hide=function(){o.$element.off("mousedown",o.$onMouseDown),s.keyboard&&t.off("keydown",o.$onKeyDown),u()},o}angular.element(t.document.body);return a.defaults=e,a}}).directive("sbTypeahead",function(e,t,n,i,a){var o=i.defaults;return{restrict:"EAC",require:"ngModel",link:function(e,t,n,s){var r={scope:e};angular.forEach(["placement","container","delay","trigger","keyboard","html","animation","template","filter","limit","tahIndex","minLength"],function(e){angular.isDefined(n[e])&&(r[e]=n[e])});var l=r.filter||o.filter,c=r.limit||o.limit,u=n.ngOptions;l&&(u+=" | "+l+":$viewValue"),c&&(u+=" | limitTo:"+c);var d=a(u),f=i(t,s,r);e.$watch(n.ngModel,function(t){e.$modelValue=t,d.valuesFn(e,s).then(function(e){e.length>c&&(e=e.slice(0,c)),(1!==e.length||e[0].value!==t)&&(f.update(e),s.$render())})}),s.$render=function(){if(s.$isEmpty(s.$viewValue))return t.val("");var e=f.$getIndex(s.$modelValue),n=angular.isDefined(e)?f.$scope.$matches[e].label:s.$viewValue;n=angular.isObject(n)?n.label:n,t.val(n.replace(/<(?:.|\n)*?>/gm,"").trim())},e.$on("$destroy",function(){f.destroy(),r=null,f=null})}}}),angular.module("angularjssearchbox").run(["$templateCache",function(e){e.put("templates/searchBox.html",'<pre ng-show="debug">Model: {{selected.key | json}} Value : {{ selected.value | json}} opened : {{ opened }}</pre>\r\n<div class="SB-search">\r\n    <div class="SB-search-box-wrapper form-control SB-search-box " >\r\n        <div class="SB-icon SB-icon-search"><span class="glyphicon glyphicon-search"></span></div>\r\n        <div class="SB-placeholder" ng-click="selectInputFacet()"></div>\r\n        <div class="SB-search-inner" >\r\n            <div class="search_parameter" ng-class="{ selected : $index == selectedResult }"\r\n                 ng-repeat="parameter in sbResultList" ng-click="selectResult($index)"\r\n                 repeat-done>\r\n                <div class="search_parameter_remove SB-icon SB-icon-cancel" ng-click="removeFilter($index)"><span class="glyphicon glyphicon-remove"></span></div>\r\n                <div class="key">{{ getFacetLabel(parameter.key) }}</div>\r\n                <div class="value" ><span class="SB-inputSizer" >{{ parameter.value }}</span>\r\n                <input type="text"\r\n                       data-tah-index="{{ $index }}"\r\n                       ng-model="parameter.value"\r\n                       ng-if="(parameter.type == null || parameter.type == \'string\')"\r\n                       class="form-control SB-inputValue"\r\n                       limit="8"\r\n                       data-trigger="focus"\r\n                       data-min-length="0"\r\n                       data-container="body"\r\n                       ng-options="element.label as element.label + \' (\' +element.count+\')\' for element in getValues(parameter.key) | filter:{label:$viewValue}"\r\n                       sb-focus sb-typeahead>\r\n                </div>\r\n            </div>\r\n            <div class="search_parameter input-facet">\r\n            <input\r\n                   data-min-length="0"\r\n                   type="text"\r\n                   ng-model="selected.key"\r\n                   data-limit="30"\r\n                   data-trigger="focus"\r\n                   data-container="body"\r\n                   data-delay="{ show: 500, hide: 0 }"\r\n                   ng-options="element as element.label for element in facetList | filter:{label:$viewValue}"\r\n                   class="form-control" sb-typeahead>\r\n            </div>\r\n\r\n        </div>\r\n        <div class="SB-icon SB-icon-cancel SB-cancel-search-box" title="clear search" ng-click="removeAll()"><span class="glyphicon glyphicon-remove-circle"></span></div>\r\n    </div>\r\n</div>\r\n<pre ng-show="debug" style="margin-top: 10px;">sbResultList: {{sbResultList | json}} </pre>\r\n<pre ng-show="debug">resultList (input/output): {{resultList | json}} </pre>\r\n<pre ng-show="debug">facetList (input): {{facetList | json}} </pre>\r\n'),e.put("templates/typeAhead.html",'<ul tabindex="-1" class="typeahead dropdown-menu" ng-show="$isVisible()" role="select">\n  <li role="presentation" ng-repeat="match in $matches" ng-class="{active: $index == $activeIndex}">\n    <a role="menuitem" tabindex="-1" ng-click="$select($index, $event)" ng-bind="match.label"></a>\n  </li>\n</ul>\n')}]);